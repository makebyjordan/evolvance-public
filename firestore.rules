
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check ownership
    function isOwner(userId) {
      return request.auth.uid == userId;
    }

    // --- Users Collection ---
    // Anyone can create a user profile (for sign up)
    // Only the owner can read or update their own profile
    // Deletion is not allowed
    match /users/{userId} {
      allow create: if request.auth != null;
      allow read, update: if isOwner(userId);
      allow delete: if false;
    }
    
    // --- User Status Collection (for Horario) ---
    // User can only read all statuses
    // User can only create/update their own status document
    match /userStatus/{userId} {
        allow read: if request.auth != null;
        // Map user ID strings to specific email addresses
        allow write: if request.auth != null && 
                     ((userId == 'sandra' && request.auth.token.email == 'sandra@evol-vance.es') ||
                      (userId == 'julian' && request.auth.token.email == 'julian@evol-vance.com') ||
                      (userId == 'jordan' && request.auth.token.email == 'jordangarciajara@gmail.com'));
    }

    // --- Public Collections (Proposals, Presentations, LandAD Responses) ---
    // Allow read access for public-facing pages
    // Write access is restricted to server-side actions (or authenticated users in dashboard)
    match /proposals/{proposalId} {
      allow read: if true;
      allow write: if request.auth != null; 
    }

    match /presentations/{presentationId} {
      allow read: if true;
      allow write: if request.auth != null; 
    }
    
    match /landAdResponses/{responseId} {
        allow create: if true; // Anyone can submit a response
        allow read, update, delete: if request.auth != null; // Only admins from dashboard
    }
    
     match /landAds/{landAdId} {
      allow read: if true;
      allow write: if request.auth != null; 
    }

    // --- General Dashboard Collections ---
    // All authenticated users can read, create, update, and delete from these collections.
    // This allows dashboard users to manage the app's content.
    match /{collection}/{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}
